\subsection{Well-Typed Holes}
\label{sec:design:holes}

Holes are a special kind of placeholder that programmers can use for parts of
the program they have not yet written.
%
In a typed language, each hole will be assigned a type based on the context it
is used in.\gallais{context as in $C[\cdot]$, not $\Gamma$. Better phrasing?}\jfdm{Perhaps: \emph{position} or \emph{placement} in the syntax tree?}

Special language support (the ability to inspect, refine, compute with,
or fill an existing hole with an adequately typed term)
enables \emph{type-driven programming}~\cite{DBLP:journals/pacmpl/OmarVCH19},
a practice by which the user interactively builds the eventual finished
program via a dialogue with the compiler.

Barebones language support should at least include the ability to inspect the
type of a hole and the local context it appears in, as well as the ability to
safely evaluate programs that still contain holes.



\Idris{}'s elaborator lifts holes to top-level declarations with no associated
definition as it encounters them.
%
Because of this design choice users cannot mention the same hole in
different places to state their intention that these yet unwritten terms ought
to be the same.
%
In \Velo{}, however, we allow holes to be mentioned arbitrarily many times in
arbitrarily different local contexts. In the following example, the hole
\texttt{?h} occurs in two distinct contexts: $\emptyset,a,x$ and $\emptyset,a,y$.

\begin{center}
  \holeexamplegraph{}
\end{center}

As a consequence, a term will only fit in that hole if it happens to live in the
shared common prefix of these two contexts ($\emptyset,a$) as references to $x$
will not make sense in $\emptyset,a,y$ and vice-versa for $y$.


Our elaborator proceeds in two steps.
%
First, a bottom-up pass records holes as they are found and, in nodes
with multiple subterms, reconciles conflicting hole occurrences by
computing the appropriate local context restriction.
%
This process produces a list of holes together with a \IdrisType{Holey}
term that contains invariants ensuring these collected holes do fit in the term.
%
Second, a top-down pass produces a core \IdrisType{Term} indexed by the list
of \IdrisType{Meta} (a simple record type recording a hole's name, the context
it lives in, and the hole's type). Hole occurences end up being assigned a thinning
embedding the metavariable's actual context into the context it appears in.

\jfdm{Should we mention that this machinery is not special to \Velo{} i.e. can be factored out?}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../paper"
%%% End:
