\documentclass[%
draft, % note that the orcid.pdf logo is not included with draft mode
a4paper,
UKenglish,
cleveref,
autoref,
thm-restate,
%anonymous,
pdfa
]{oasics-v2021}

\usepackage{todonotes}
\setuptodonotes{inline}

\usepackage{relsize}

\usepackage{tikz}
\usetikzlibrary{shapes.geometric}

\usepackage{acronym}
\usepackage{xspace}
\usepackage[commandnameprefix=always]{changes}
\usepackage{fancyvrb}
\usepackage{jfdm-plt}
\usepackage{velo}

\pdfoutput=1
\hideOASIcs %uncomment to remove references to OASIcs series (logo, DOI, ...), e.g. when preparing a pre-final version to be uploaded to arXiv or another public repository

%\graphicspath{{./graphics/}}%helpful if your graphic files are in another directory

\bibliographystyle{plainurl}% the mandatory bibstyle

\title{Type Theory as a Language Workbench} %TODO Please add

\author
{Jan {de Muijnck-Hughes}}
{University of Glasgow, UK}
{Jan.deMuijnck-Hughes@glasgow.ac.uk}
{https://orcid.org/0000-0003-2185-8543}
{} % TODO

\author
{Guillaume Allais}
{University of St Andrews, UK}
{gxa1@st-andrews.ac.uk} % Check
{https://orcid.org/0000-0002-4091-657X} % ORCID
{} % TODO

\author
{Edwin Brady}
{University of St Andrews, UK}
{ecb10@st-andrews.ac.uk} % Check
{} % ORCID
{} % TODO

\input{./preamble}

\begin{document}

\input{./notations}

\maketitle

% 1. State the problem
% 2. Say why it is an interesting problem
% 3. Say what your solution achieves
% 4. Say what follows from your solution

\begin{abstract}
We are planning to showcase dependently typed techniques to implement \& manipulate IRs.

The key components we are planning to treat are:

\begin{itemize}
\item Efficient de Bruijn representations
\item Co de Bruijn for CSE
\item Evaluation as Progress (with computation rules in one separate function)
\item Well scoped holes
\item Linear (in number of cases) decidable equality
\item Compact constant folding
\item Positive evidence for negative statements
\item Whole pipeline (parser, elaborator, REPL, evaluator, compiler passes)
\end{itemize}

Our ongoing work is available at:

\url{https://github.com/jfdm/velo-lang}
\end{abstract}

\todo{Run spellcheck}
\todo{Use Katla to typeset Idris 2 code}

\section{Introduction}
\label{sec:introduction}

\input{./content/introduction}


\section{Introducing Velo}
\label{sec:velo}

\input{./content/velo-intro}

\section{Language Design}
\label{sec:design}

This section details key design rationale on realising the static and dynamic semantics of \Velo{} within Idris.

We have opted to give \Velo{} an external concrete syntax (a \ac{dsl}) in which users can write their programs.
%
With dependently typed languages, however, we can also capture the abstract syntax and its static semantics as a well-typed \ac{edsl} directly with the host language~\cite{Augustsson1999edt}.
Our terms will thus be implemented as a data structure with (almost) the following type:

\begin{Verbatim}
data Ty = TyNat | TyBool | TyArr Ty Ty
data Term : (ctxt : List Ty) -> (type : Ty) -> Type where
  Zero : Term ctxt TyNat
  Inc : Term ctxt TyNat -> Term ctxt TyNat
  -- ...
\end{Verbatim}

\noindent

Using such intrinsically typed \acp{edsl} we can statically verify for free that our language's are well-structured and that any transformation (model-to-model) or interpretation (model-to-host) respects the language's static semantics.
In fact we will describe in \Cref{sec:compiler} how we can use our \acp{edsl} to both verify our static semantics and describe our dynamic semantics.

\input{./content/deBruijn}
\input{./content/compactconstant}


\subsection{Well-Typed Holes}
\label{sec:design:holes}

\chcomment{Well-Typed Holes}

\section{Optimisation}
\label{sec:compiler-pass}
\chcomment{Co-\DeBruijn{} for CSE}

\input{./content/cse}

\section{Execution}
\label{sec:semantics}

\chcomment{Evaluation as Progress (with computation rules in one separate function)}

\section{Good Programming Idioms}
\label{sec:idioms}

We end our tour of \Velo{} by detailing two programming idioms that helped with the reporting of errors, and reasoning about decidable equality of inductive data structures.

\input{./content/positivelynegative}
\input{./content/efficientdeceq}

\section{Conclusion}
\label{sec:conclusion}

% we have 2 pages of refs for free
\newpage
\bibliography{paper}

\newpage
\appendix

\begin{figure}[ht]
  \centering
  \input{./figure/syntax}
  \caption{\label{fig:velo:syntax}\Velo{} Formal Abstract Syntax}
\end{figure}

\begin{figure}[ht]
  \centering
  \input{./figure/statics}
  \caption{\label{fig:velo:statics}\Velo{} Typing Rules}
\end{figure}

\begin{figure}[ht]
  \centering
  \input{./figure/dynamics-smallstep}
  \caption{\label{fig:velo:statics}\Velo{} SmallStep Reduction Semantics}
\end{figure}

\end{document}
